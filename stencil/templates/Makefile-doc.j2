format-md: ## Format markdown files
	$(DC) pull format-md
	$(DC) run --rm format-md

{% if has_docs %}
# WITH: Comma-separated features to include (e.g., WITH=hidden or WITH=hidden,draft)
# Lowercase 'with' also works: with=hidden
WITH ?= $(with)

# Helper to define comma (must be before its use)
comma := ,

# Build metadata flags from WITH variable
METADATA_FLAGS := $(foreach feat,$(subst $(comma), ,$(WITH)),--metadata include-$(feat)=true)

# Build output suffix from WITH variable (e.g., -hidden or -hidden-draft)
OUTPUT_SUFFIX := $(if $(WITH),$(addprefix -,$(subst $(comma),-,$(WITH))),)

doc: format-md ## Generate HTML docs (use WITH=hidden to include hidden sections)
	$(DC) pull doc
{% for md in docs %}
	$(DC) run --rm doc --metadata title="{{ name }}" $(METADATA_FLAGS) {{ md }} -o {{ md | replace('.md', '') }}$(OUTPUT_SUFFIX).html
{% endfor %}
	@echo "Generated docs$(if $(WITH), with features: $(WITH),)"

{% endif %}
